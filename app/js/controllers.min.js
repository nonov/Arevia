"use strict";var areviaControllers=angular.module("areviaControllers",["angularFileUpload"]);areviaControllers.controller("AppCtrl",["$scope","AuthService",function(e,t){e.section=0,e.isAuthorized=t.isAuthorized}]),areviaControllers.controller("NavCtrl",["$scope","$location",function(e,t){e.getPath=function(){return"/leMondeDArevia"===t.path()?!0:!1}}]),areviaControllers.controller("BlogCtrl",["$scope","ArticleService","$timeout","$rootScope","FileService","ARTICLE_EVENTS","PostsService","AuthService","AUTH_EVENTS","$location","POSTS_EVENTS",function(e,t,o,n,l,i,s,c,a,r,d){n.display=function(){t.get().then(function(t){for(var n=0;n<t.length;n++)t[n].img_path=t[n].img_path;e.articles=t,e.articlePolling=o(e.display,3600)},function(){n.message="Il n'y a pas d'articles !",e.articles=null,n.$broadcast(i.selectFailed),o(e.display,3600)})},e.fullArticle=function(t){o.cancel(e.articlePolling),n.currentArticle=t,$j("#articleModal").modal("show"),s.get(t.id).then(function(t){n.currentArticlePosts=t,n.messagePost=null,e.displayPost()},function(){n.currentArticlePosts=null,n.messagePost="Il n'y a pas de commentaires!",e.displayPost()})},$j("#articleModal").on("hidden.bs.modal",function(){o.cancel(e.postPolling),console.log("closed")}),e.displayPost=function(){s.get(n.currentArticle.id).then(function(t){n.currentArticlePosts=t,n.messagePost=null,e.postPolling=o(e.displayPost,3600)},function(){n.currentArticlePosts=null,n.messagePost="Il n'y a pas de commentaires!",o(e.displayPost,3600)})},e.signOut=function(){c.logout().then(function(){n.$broadcast(a.logoutSuccess),r.path("/")})},e.OpenDeleteArticle=function(e){n.delArticle=e,$j("#deleteArticleModal").modal("show")},e.deleteArticle=function(){l.delete(n.delArticle.id).then(function(){t.delete(n.delArticle.id).then(function(){n.$broadcast(i.deleteSuccess)},function(){n.$broadcast(i.deleteFailed)})})},e.deletePost=function(){s.delete(n.delPost).then(function(){n.$broadcast(d.deleteSuccess)},function(){n.$broadcast(d.deleteFailed)})}}]),areviaControllers.controller("PostCtrl",["$scope","$rootScope","PostsService","POSTS_EVENTS","ARTICLE_EVENTS",function(e,t,o,n){e.addPost=function(l){var i={id:l,content:e.posts.message,firstname:e.posts.firstname,email:e.posts.email};o.post(i).then(function(){t.$broadcast(n.postSuccess)},function(){t.$broadcast(n.postFailed)}),e.posts="",e.postsForm.$setPristine()},e.OpenDeletePost=function(e){t.delPost=e,$j("#deletePostModal").modal("show")}}]),areviaControllers.controller("AuthCtrl",["$scope","AuthService","$rootScope","$route","AUTH_EVENTS","AuthInterceptor",function(e,t,o,n,l,i){o.currentUser=null,e.credentials={login:"",password:""},e.signIn=function(e){t.login(e).then(function(e){o.currentUser=e,o.$broadcast(l.loginSuccess),$j("#connexionModal").modal("hide"),n.reload()},function(e){e.status=parseInt(e.data),i.responseError(e),o.$broadcast(l.loginFailed)})}}]),areviaControllers.controller("ArticleCtrl",["$scope","FileService","FILE_EVENTS","ARTICLE_EVENTS","ArticleService","$rootScope","$upload",function(e,t,o,n,l,i){e.imgIsEnable=!1,e.dismissModal=!1,e.$watch("files",function(){e.upload()}),e.upload=function(){angular.forEach(t.update(e.files,"/Arevia/RESTapi/public/api/article/setPicture"),function(t){t.then(function(t){e.imgIsEnable=!!t,e.fileName=t.data,i.$broadcast(o.uploadSuccess)},function(){i.$broadcast(o.updateFailed)})})},e.addArticle=function(){e.article={title:e.inputs.title,content:e.inputs.content,img_path:e.fileName},l.post(e.article).then(function(){i.$broadcast(n.postSuccess),$j("#addArticleModal").modal("hide"),i.message=""},function(){i.$broadcast(n.postFailed)}),e.inputs="",e.imgIsEnable=!1,e.addArticleForm.$setPristine()}}]);